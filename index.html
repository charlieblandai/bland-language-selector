// Language selector component with structured message format

const languages = [
  { code: 'en', name: 'English' },
  { code: 'es', name: 'Español (Spanish)' },
  { code: 'fr', name: 'Français (French)' },
  { code: 'de', name: 'Deutsch (German)' },
  { code: 'it', name: 'Italiano (Italian)' },
  { code: 'pt', name: 'Português (Portuguese)' },
  { code: 'zh', name: '中文 (Chinese)' },
  { code: 'ja', name: '日本語 (Japanese)' },
  { code: 'ko', name: '한국어 (Korean)' },
  { code: 'ar', name: 'العربية (Arabic)' }
];

document.addEventListener('DOMContentLoaded', () => {
  console.log('Event listeners attached');
  const select = document.getElementById('languageSelect');
  const status = document.getElementById('status');
  
  console.log('Component loaded');
  console.log('In iframe:', window !== window.parent);
  console.log('Parent exists:', window.parent !== window);
  console.log('Window location:', window.location.href);
  
  // Populate dropdown
  languages.forEach(lang => {
    const option = document.createElement('option');
    option.value = lang.code;
    option.textContent = lang.name;
    select.appendChild(option);
  });
  
  select.addEventListener('change', (e) => {
    const languageCode = e.target.value;
    const languageName = languages.find(l => l.code === languageCode)?.name || languageCode;
    
    console.log(`Language selected: ${languageCode} (${languageName})`);
    
    // Send structured message to pathway
    const message = `widget-message:My language preference is ${languageCode}`;
    console.log('Attempting to send:', JSON.stringify(message));
    
    try {
      // Try all three methods
      window.parent.postMessage(message, '*');
      console.log('✓ Sent via window.parent.postMessage');
      
      parent.window.postMessage(message, '*');
      console.log('✓ Sent via parent.window.postMessage');
      
      window.top.postMessage(message, '*');
      console.log('✓ Sent via window.top.postMessage');
      
      // Update UI
      status.textContent = `✓ Language set to ${languageName}`;
      status.style.color = '#10b981';
      select.disabled = true;
      
    } catch (error) {
      console.error('Error sending message:', error);
      status.textContent = '✗ Failed to send language selection';
      status.style.color = '#ef4444';
    }
  });
});
